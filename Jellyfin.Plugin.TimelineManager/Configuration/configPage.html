<!DOCTYPE html>
<html>

<head>
    <title>Universal Timeline Manager</title>
</head>

<body>
    <div data-role="page" class="page type-interior pluginConfigurationPage">
        <div data-role="content">
            <div class="content-primary">
                <div style="display: flex; align-items: center; margin-bottom: 1em;">
                    <h1>Universal Timeline Manager</h1>
                    <a class="emby-button raised button-alt headerHelpButton"
                        href="https://github.com/ngdtam/jellyfin-timeline-plugin" target="_blank"
                        rel="noopener noreferrer" style="padding: 0.4em 0.8em; margin-left: 1em;">Help</a>
                </div>

                <p style="margin-bottom: 1.5em;">Create chronological playlists for cinematic universes based on your JSON configuration file.</p>

                <form style="margin: 0;">
                    <!-- Notification area -->
                </form>

                <!-- Tab Navigation -->
                <div class="tab-navigation" style="display: flex; gap: 0.5em; margin-bottom: 1.5em; border-bottom: 2px solid #333;">
                    <button type="button" class="tab-button active" data-tab="universe-management" style="padding: 0.75em 1.5em; background: #00a4dc; color: white; border: none; border-radius: 4px 4px 0 0; cursor: pointer; font-size: 1em;">
                        Universe Management
                    </button>
                    <button type="button" class="tab-button" data-tab="playlist-creator" style="padding: 0.75em 1.5em; background: #2a2a2a; color: white; border: none; border-radius: 4px 4px 0 0; cursor: pointer; font-size: 1em;">
                        Playlist Creator
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Tab 1: Universe Management -->
                    <div id="universe-management-tab" class="tab-pane" style="display: block;">

                <div class="verticalSection">
                    <h2 class="sectionTitle">TMDB Settings</h2>
                    
                    <div class="inputContainer" style="margin-bottom: 1em;">
                        <div class="fieldDescription" style="margin-bottom: 1em;">
                            Configure your TMDB API key to enable searching for movies and TV shows not in your Jellyfin library. Get a free API key at <a href="https://www.themoviedb.org/settings/api" target="_blank" rel="noopener noreferrer">themoviedb.org/settings/api</a>.
                        </div>
                        
                        <label class="inputLabel" for="tmdbApiKey">TMDB API Key:</label>
                        <input type="text" id="tmdbApiKey" class="emby-input" placeholder="Enter your TMDB API key" />
                        
                        <button type="button" is="emby-button" id="saveTmdbSettingsBtn" class="emby-button raised" style="margin-top: 1em;">
                            Save TMDB Settings
                        </button>
                        
                        <div id="tmdbSettingsMessage" style="margin-top: 1em; padding: 1em; border-radius: 4px; display: none;"></div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">Universe Manager</h2>
                    
                    <div class="inputContainer" style="margin-bottom: 1em;">
                        <div class="fieldDescription" style="margin-bottom: 1em;">
                            Select which universes to create playlists for. You can also edit universe configurations directly in the browser.
                        </div>
                        
                        <div id="universeList" style="margin-bottom: 1em;"></div>
                        
                        <div style="display: flex; gap: 0.5em; margin-bottom: 1em;">
                            <button type="button" is="emby-button" id="selectAllBtn" class="emby-button raised">
                                Select All
                            </button>
                            <button type="button" is="emby-button" id="deselectAllBtn" class="emby-button raised">
                                Deselect All
                            </button>
                            <button type="button" is="emby-button" id="refreshUniversesBtn" class="emby-button raised">
                                Refresh List
                            </button>
                        </div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">Create Playlists</h2>
                    
                    <div class="inputContainer" style="margin-bottom: 1em;">
                        <div class="fieldDescription" style="margin-bottom: 1em;">
                            Click the button below to create playlists from selected universes.
                        </div>
                        
                        <button type="button" is="emby-button" id="createPlaylistsBtn" class="emby-button raised block">
                            Create Playlists for Selected Universes
                        </button>
                    </div>

                    <div id="statusMessage" style="margin-top: 1em; padding: 1em; border-radius: 4px; display: none;"></div>
                    <div id="outputBox" style="background: #0a0a0a; color: #00ff00; padding: 1em; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; margin-top: 1em; display: none;"></div>
                    <div id="errorBox" style="background: #2a0000; color: #ff6b6b; padding: 1em; border-radius: 4px; font-family: monospace; white-space: pre-wrap; margin-top: 1em; display: none;"></div>
                </div>

                <div id="jsonEditorSection" class="verticalSection" style="display: none;">
                    <h2 class="sectionTitle">Edit Universe: <span id="editorUniverseName"></span></h2>
                    
                    <div class="inputContainer" style="margin-bottom: 1em;">
                        <div class="fieldDescription" style="margin-bottom: 1em;">
                            Edit the JSON configuration for this universe. Changes will be saved to the file.
                        </div>
                        
                        <textarea id="jsonContent" style="width: 100%; min-height: 400px; font-family: monospace; background: #1a1a1a; color: #e0e0e0; border: 1px solid #444; border-radius: 4px; padding: 1em;"></textarea>
                        
                        <div id="validationErrors" style="background: #2a0000; color: #ff6b6b; padding: 1em; border-radius: 4px; margin-top: 1em; display: none;"></div>
                        
                        <div style="display: flex; gap: 0.5em; margin-top: 1em;">
                            <button type="button" is="emby-button" id="saveUniverseBtn" class="emby-button raised">
                                Save Universe
                            </button>
                            <button type="button" is="emby-button" id="cancelEditBtn" class="emby-button raised">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>

                <div class="verticalSection">
                    <h2 class="sectionTitle">Manage Playlists</h2>
                    
                    <div class="inputContainer" style="margin-bottom: 1em;">
                        <div class="fieldDescription" style="margin-bottom: 1em;">
                            View and manage playlists created by this plugin.
                        </div>
                        
                        <button type="button" is="emby-button" id="refreshPlaylistsBtn" class="emby-button raised block" style="margin-bottom: 1em;">
                            Refresh Playlist List
                        </button>
                        
                        <div id="playlistsContainer" style="margin-top: 1em;"></div>
                    </div>
                </div>

                    </div>
                    <!-- End Tab 1 -->

                    <!-- Tab 2: Playlist Creator -->
                    <div id="playlist-creator-tab" class="tab-pane" style="display: none;">

                <div class="verticalSection">
                    <h2 class="sectionTitle">Playlist Creator</h2>
                    
                    <div class="inputContainer" style="margin-bottom: 1em;">
                        <div class="fieldDescription" style="margin-bottom: 1em;">
                            Create and edit playlists visually without writing JSON. Search for content, arrange items in your preferred order, and save as universe files.
                        </div>
                        
                        <button type="button" is="emby-button" id="createNewPlaylistBtn" class="emby-button raised">
                            Create New Playlist
                        </button>
                    </div>
                    
                    <div id="playlistCreatorForm" style="display: none;">
                        <div class="inputContainer" style="margin-bottom: 1em;">
                            <label class="inputLabel" for="playlistKey">Playlist Key (unique identifier, no spaces):</label>
                            <input type="text" id="playlistKey" class="emby-input" placeholder="e.g., my-playlist" />
                            <div id="keyValidationError" class="fieldDescription" style="color: #ff6b6b; display: none; margin-top: 0.5em;"></div>
                        </div>
                        
                        <div class="inputContainer" style="margin-bottom: 1em;">
                            <label class="inputLabel" for="playlistName">Playlist Name:</label>
                            <input type="text" id="playlistName" class="emby-input" placeholder="e.g., My Custom Playlist" />
                            <div id="nameValidationError" class="fieldDescription" style="color: #ff6b6b; display: none; margin-top: 0.5em;"></div>
                        </div>
                        
                        <div class="inputContainer" style="margin-bottom: 1em;">
                            <label class="inputLabel">Search Source:</label>
                            <div style="display: flex; gap: 0.5em; margin-bottom: 1em;">
                                <button type="button" id="searchSourceJellyfin" class="emby-button raised search-source-toggle active" data-source="jellyfin" style="background: #00a4dc; color: white;">
                                    Jellyfin Library
                                </button>
                                <button type="button" id="searchSourceTmdb" class="emby-button raised search-source-toggle" data-source="tmdb" style="background: #2a2a2a; color: white;">
                                    TMDB
                                </button>
                            </div>
                            <div id="searchSourceIndicator" class="fieldDescription" style="margin-bottom: 0.5em;">
                                Searching in: <strong>Jellyfin Library</strong>
                            </div>
                        </div>
                        
                        <div class="inputContainer" style="margin-bottom: 1em;">
                            <label class="inputLabel" for="contentSearchInput">Search for Movies/Episodes:</label>
                            <input type="text" id="contentSearchInput" class="emby-input" placeholder="Type to search..." />
                            <div id="searchResults" style="margin-top: 0.5em; display: none;"></div>
                        </div>
                        
                        <div class="inputContainer" style="margin-bottom: 1em;">
                            <label class="inputLabel">Playlist Items:</label>
                            <div id="playlistItemsList" style="border: 1px solid #333; border-radius: 4px; padding: 1em; min-height: 100px;">
                                <div id="emptyStateMessage" class="fieldDescription">No items added yet. Search and select content above to add items.</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 0.5em; margin-top: 1em;">
                            <button type="button" is="emby-button" id="savePlaylistBtn" class="emby-button raised">
                                Save Playlist
                            </button>
                            <button type="button" is="emby-button" id="createJellyfinPlaylistBtn" class="emby-button raised" disabled>
                                Create Jellyfin Playlist
                            </button>
                            <button type="button" is="emby-button" id="cancelPlaylistBtn" class="emby-button raised">
                                Cancel
                            </button>
                        </div>
                        
                        <div id="playlistStatusMessage" style="margin-top: 1em; padding: 1em; border-radius: 4px; display: none;"></div>
                    </div>
                </div>

                    </div>
                    <!-- End Tab 2 -->
                </div>
                <!-- End Tab Content -->

                <script src="configurationpage?name=configPage.js"></script>
            </div>
        </div>
    </div>
</body>
</html>
