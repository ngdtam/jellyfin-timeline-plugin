<!-- Timeline Manager Configuration - Standalone Version -->
<div id="timelineManagerStandaloneConfig" style="padding: 2em;">
    <h2>Universal Timeline Manager Configuration</h2>
    
    <div style="margin-bottom: 2em;">
        <h3>Timeline Configuration Editor</h3>
        <p style="color: #ccc;">
            Edit your timeline configuration below. The configuration defines which movies and TV episodes belong to each cinematic universe in chronological order.
        </p>
        
        <div style="margin-top: 1em;">
            <label style="display: block; margin-bottom: 0.5em; font-weight: bold;">JSON Configuration:</label>
            <textarea 
                id="timelineJsonEditor" 
                style="font-family: 'Courier New', monospace; font-size: 0.9em; width: 100%; padding: 10px; box-sizing: border-box; background: #1a1a1a; color: #fff; border: 1px solid #444; border-radius: 4px;"
                rows="20">
            </textarea>
            <div style="color: #999; font-size: 0.9em; margin-top: 0.5em;">
                Edit the JSON configuration above. Use Provider IDs (TMDB/IMDB) to identify your content.
            </div>
        </div>

        <div id="timelineMessageContainer" style="margin-top: 1em; display: none;"></div>

        <div style="margin-top: 1.5em;">
            <button type="button" style="padding: 10px 20px; margin-right: 10px; background: #52b54b; color: white; border: none; border-radius: 4px; cursor: pointer;" id="timelineValidateBtn">
                Validate Configuration
            </button>
            <button type="button" style="padding: 10px 20px; margin-right: 10px; background: #00a4dc; color: white; border: none; border-radius: 4px; cursor: pointer;" id="timelineSaveBtn">
                Save Configuration
            </button>
            <button type="button" style="padding: 10px 20px; background: #666; color: white; border: none; border-radius: 4px; cursor: pointer;" id="timelineLoadSampleBtn">
                Load Sample
            </button>
        </div>
    </div>

    <div style="margin-bottom: 2em;">
        <h3>Configuration Format</h3>
        <div style="color: #ccc;">
            <p><strong>Required Fields:</strong></p>
            <ul>
                <li><strong>key:</strong> Unique identifier for the universe (e.g., "mcu", "dceu")</li>
                <li><strong>name:</strong> Display name (e.g., "Marvel Cinematic Universe")</li>
                <li><strong>providerId:</strong> TMDB or IMDB ID for the content</li>
                <li><strong>providerName:</strong> Either "tmdb" or "imdb"</li>
                <li><strong>type:</strong> Either "movie" or "episode"</li>
            </ul>
        </div>
    </div>

    <div>
        <h3>How to Find Provider IDs</h3>
        <div style="color: #ccc;">
            <p><strong>TMDB IDs:</strong> Visit <a href="https://www.themoviedb.org" target="_blank" rel="noopener" style="color: #00a4dc;">themoviedb.org</a>, search for your content, and copy the ID from the URL</p>
            <p><strong>IMDB IDs:</strong> Visit <a href="https://www.imdb.com" target="_blank" rel="noopener" style="color: #00a4dc;">imdb.com</a>, search for your content, and copy the ID (starts with "tt")</p>
            <p><strong>From Jellyfin:</strong> Right-click content → Edit Metadata → External IDs tab</p>
        </div>
    </div>
</div>

<script type="text/javascript">
(function() {
    console.log('[Timeline Standalone] Script loaded');
    
    var sampleConfig = {
        "universes": [
            {
                "key": "mcu",
                "name": "Marvel Cinematic Universe",
                "items": [
                    {
                        "providerId": "1771",
                        "providerName": "tmdb",
                        "type": "movie"
                    },
                    {
                        "providerId": "1399",
                        "providerName": "tmdb",
                        "type": "episode"
                    }
                ]
            }
        ]
    };

    function showMessage(message, isError) {
        console.log('[Timeline] Showing message:', message);
        var messageContainer = document.getElementById('timelineMessageContainer');
        messageContainer.style.display = 'block';
        messageContainer.style.padding = '1em';
        messageContainer.style.borderRadius = '4px';
        messageContainer.style.marginTop = '1em';
        
        if (isError) {
            messageContainer.style.background = 'rgba(255, 0, 0, 0.1)';
            messageContainer.style.borderLeft = '4px solid #ff0000';
            messageContainer.style.color = '#ff6b6b';
        } else {
            messageContainer.style.background = 'rgba(0, 255, 0, 0.1)';
            messageContainer.style.borderLeft = '4px solid #00ff00';
            messageContainer.style.color = '#51cf66';
        }
        
        messageContainer.innerHTML = message;
    }

    function hideMessage() {
        document.getElementById('timelineMessageContainer').style.display = 'none';
    }

    function loadConfiguration() {
        console.log('[Timeline] Loading configuration');
        
        if (!window.ApiClient) {
            console.error('[Timeline] ApiClient not available');
            document.getElementById('timelineJsonEditor').value = JSON.stringify(sampleConfig, null, 2);
            return;
        }
        
        window.ApiClient.ajax({
            url: window.ApiClient.getUrl('Timeline/Config'),
            type: 'GET',
            dataType: 'json'
        }).then(function(config) {
            console.log('[Timeline] Config loaded:', config);
            var jsonEditor = document.getElementById('timelineJsonEditor');
            if (config && config.universes && config.universes.length > 0) {
                jsonEditor.value = JSON.stringify(config, null, 2);
            } else {
                jsonEditor.value = JSON.stringify(sampleConfig, null, 2);
            }
        }).catch(function(error) {
            console.error('[Timeline] Error loading configuration:', error);
            document.getElementById('timelineJsonEditor').value = JSON.stringify(sampleConfig, null, 2);
        });
    }

    function validateConfiguration() {
        console.log('[Timeline] Validate clicked');
        hideMessage();
        
        var jsonEditor = document.getElementById('timelineJsonEditor');
        var jsonContent = jsonEditor.value.trim();
        
        if (!jsonContent) {
            showMessage('Please enter a configuration to validate', true);
            return;
        }

        try {
            JSON.parse(jsonContent);
        } catch (e) {
            console.error('[Timeline] JSON parse error:', e);
            showMessage('<strong>JSON Syntax Error:</strong><br>' + e.message, true);
            return;
        }

        console.log('[Timeline] Sending validation request');
        window.ApiClient.ajax({
            url: window.ApiClient.getUrl('Timeline/Validate'),
            type: 'POST',
            data: JSON.stringify({ jsonContent: jsonContent }),
            contentType: 'application/json',
            dataType: 'json'
        }).then(function(result) {
            console.log('[Timeline] Validation result:', result);
            if (result.isValid) {
                showMessage('<strong>✓ ' + result.message + '</strong>', false);
            } else {
                var errorHtml = '<strong>' + result.message + '</strong><ul style="margin: 0.5em 0; padding-left: 1.5em;">';
                result.errors.forEach(function(error) {
                    errorHtml += '<li>' + error + '</li>';
                });
                errorHtml += '</ul>';
                showMessage(errorHtml, true);
            }
        }).catch(function(error) {
            console.error('[Timeline] Validation error:', error);
            showMessage('<strong>Error:</strong> ' + (error.message || 'Unknown error'), true);
        });
    }

    function saveConfiguration() {
        console.log('[Timeline] Save clicked');
        hideMessage();
        
        var jsonEditor = document.getElementById('timelineJsonEditor');
        var jsonContent = jsonEditor.value.trim();
        
        if (!jsonContent) {
            showMessage('Please enter a configuration to save', true);
            return;
        }

        try {
            JSON.parse(jsonContent);
        } catch (e) {
            showMessage('<strong>JSON Syntax Error:</strong><br>' + e.message + '<br><br>Please fix the JSON syntax before saving.', true);
            return;
        }

        console.log('[Timeline] Sending save request');
        window.ApiClient.ajax({
            url: window.ApiClient.getUrl('Timeline/Save'),
            type: 'POST',
            data: JSON.stringify({ jsonContent: jsonContent }),
            contentType: 'application/json',
            dataType: 'json'
        }).then(function(result) {
            console.log('[Timeline] Save result:', result);
            if (result.success) {
                showMessage('<strong>✓ Configuration saved successfully!</strong><br>Your timeline configuration has been saved.', false);
            } else {
                var errorHtml = '<strong>Save Failed:</strong><br>' + result.message;
                if (result.errors && result.errors.length > 0) {
                    errorHtml += '<ul style="margin: 0.5em 0; padding-left: 1.5em;">';
                    result.errors.forEach(function(error) {
                        errorHtml += '<li>' + error + '</li>';
                    });
                    errorHtml += '</ul>';
                }
                showMessage(errorHtml, true);
            }
        }).catch(function(error) {
            console.error('[Timeline] Save error:', error);
            showMessage('<strong>Error:</strong> ' + (error.message || 'Unknown error'), true);
        });
    }

    function loadSample() {
        console.log('[Timeline] Load sample clicked');
        document.getElementById('timelineJsonEditor').value = JSON.stringify(sampleConfig, null, 2);
        showMessage('Sample configuration loaded. Edit as needed and click Validate.', false);
    }

    // Initialize when DOM is ready
    function init() {
        console.log('[Timeline] Initializing standalone config');
        
        loadConfiguration();
        
        document.getElementById('timelineValidateBtn').addEventListener('click', function(e) {
            e.preventDefault();
            validateConfiguration();
        });
        
        document.getElementById('timelineSaveBtn').addEventListener('click', function(e) {
            e.preventDefault();
            saveConfiguration();
        });
        
        document.getElementById('timelineLoadSampleBtn').addEventListener('click', function(e) {
            e.preventDefault();
            loadSample();
        });
        
        console.log('[Timeline] Initialization complete');
    }

    // Wait for DOM and ApiClient to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>
